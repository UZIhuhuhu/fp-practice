## å‡½æ•°å¼ç¼–ç¨‹åœ¨å‰ç«¯ä¸­çš„çœŸæ­£ç”¨é€”

### React ä¸­æ¶‰åŠåˆ°çš„å‡½æ•°å¼

#### æ¸²æŸ“æ¨¡å¼

UI = View(State)

#### Components as functions

```jsx
const Hello = (props) => <div>Hello {props.name}!</div>;
```

#### Propsçš„ä¸å¯å˜


---

#### Redux ä¼˜é›…çš„ä¿®æ”¹å…±äº«çŠ¶æ€

(state, action) => state

å‰ç«¯ç»„ä»¶ä¸­çš„å…±äº«çŠ¶æ€

A çŠ¶æ€ä¼šè¢« B,C ç»„ä»¶**å½±å“**æˆ–è€…**ä¾èµ–**

æˆ–è€…æ›´å¤šçš„ï¼ŒD E F G å‡½æ•°ç”¨åˆ°è¿™ä¸ªçŠ¶æ€ï¼ŒH I J K L ç»„ä»¶ä¼šå½±å“è¿™ä¸ªçŠ¶æ€

![](./react-1.png)

![](./react-2.png)

---

#### é«˜é˜¶ç»„ä»¶

```js
import React, { Component } from 'react'

export default (WrappedComponent, name) => {
  class NewComponent extends Component {
    constructor () {
      super()
      this.state = { data: null }
    }

    componentWillMount () {
      let data = localStorage.getItem(name)
      this.setState({ data })
    }

    render () {
      return <WrappedComponent data={this.state.data} />
    }
  }
  return NewComponent
}
```

**ä¸‹é¢å°±æ˜¯ç»„ä»¶åœ¨å…·ä½“é¡µé¢ä¸­çš„ä½¿ç”¨äº†**

è¿™äº›ç»„ä»¶çš„å…±åŒç‰¹ç‚¹å°±æ˜¯ä»ä¸€æ®µè¯·æ±‚ä¸­æ‹¿åˆ°æ•°æ®æ”¾åˆ°ç»„ä»¶ä¸­ï¼Œé‚£è¿™æ®µé€»è¾‘å°±æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬æŠ½ç¦»å‡ºæ¥æ”¾åˆ°é«˜é˜¶ç»„ä»¶ä¸­å»ã€‚**é«˜é˜¶ç»„ä»¶å†…éƒ¨çš„åŒ…è£…ç»„ä»¶å’Œè¢«åŒ…è£…ç»„ä»¶ä¹‹é—´é€šè¿‡ `props` ä¼ é€’æ•°æ®ã€‚**

```js
import wrapWithLoadData from './wrapWithLoadData'

class InputWithUserName extends Component {
  render () {
    return <input value={this.props.data} />
  }
}

InputWithUserName = wrapWithLoadData(InputWithUserName, 'username')
export default InputWithUserName
```

```js
import wrapWithLoadData from './wrapWithLoadData'

class TextareaWithContent extends Component {
  render () {
    return <textarea value={this.props.data} />
  }
}

TextareaWithContent = wrapWithLoadData(TextareaWithContent, 'content')
export default TextareaWithContent
```

**é«˜é˜¶ç»„ä»¶çš„çµæ´»æ€§**

æ¯”å¦‚æˆ‘ä»¬ç°åœ¨çš„éœ€æ±‚æ”¹æˆä» `localStorage` ä¸­æ‹¿åˆ°æŸä¸ªæ•°æ®ï¼Œæ³¨å…¥ç»„ä»¶ä¸­ã€‚

```js
import React, { Component } from 'react'

export default (WrappedComponent, name) => {
  class NewComponent extends Component {
    constructor () {
      super()
      this.state = { data: null }
    }

    componentWillMount () {
      ajax.get('/data/' + name, (data) => {
        this.setState({ data })
      })
    }

    render () {
      return <WrappedComponent data={this.state.data} />
    }
  }
  return NewComponent
}
```

æˆ‘ä»¬ç”šè‡³å¯ä»¥å†™ä¸ªæ›´é«˜é˜¶çš„

![](./react-3.png)

---

### å®é™…çš„åœºæ™¯

#### ä¼˜åŒ–ç»‘å®š

å‰ç«¯å’Œåç«¯ä¸ä¸€æ ·çš„å…³é”®ç‚¹æ˜¯åç«¯HTTPè¾ƒå¤šï¼Œå‰ç«¯æ¸²æŸ“å¤šï¼Œå‰ç«¯çœŸæ­£çš„åˆšéœ€æ˜¯æ•°æ®ç»‘å®šæœºåˆ¶ã€‚åç«¯ä¸€æ¬¡å¯¹è¯ï¼Œè®¡ç®—å¥½Responseå‘å›å°±å®Œæˆä»»åŠ¡äº†ï¼Œæ‰€ä»¥åç«¯ç”¨äº†é‚£ä¹ˆå¤šå¹´çš„ MVC è¿˜æ˜¯å¾ˆå¥½ç”¨ã€‚å‰ç«¯å¤„ç†çš„æ˜¯è¿ç»­çš„æ—¶é—´è½´ï¼Œå¹¶éä¸€æ¬¡å¯¹è¯ï¼Œåƒåç«¯é‚£æ ·èµ‹å€¼ç®€å•ä¼ é€’å°±å®¹æ˜“æ–­æ¡£ï¼Œå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ï¼Œå¸¦æ¥å¤§é‡é¢å¤–å¤æ‚åº¦å’ŒBugã€‚ä¸ç®¡æ˜¯æ ‡å‡†FRPè¿˜æ˜¯Mobxè¿™ç§å‘½ä»¤å¼APIçš„TFRPï¼Œå†…éƒ¨éƒ½æ˜¯åŸºäºå‡½æ•°å¼è®¾è®¡çš„ã€‚å‡½æ•°å¼é‡æ–°å‘æ˜çš„Returnå’Œåˆ†å·æ˜¯è¦æ¯”è£¸å‘½ä»¤å¼å¥½å¾—å¤šçš„ï¼ˆå‰ç«¯çŠ¶æ€å¯ä»¥åŒæ­¥ï¼Œåç«¯çº¿ç¨‹å®‰å…¨ç­‰ç­‰ï¼Œæƒ³æ€ä¹ˆå°è£…å°±æ€ä¹ˆå°è£…ï¼‰

#### å°è£…ä½œç”¨

æ¥ä¸Šæ¡ï¼Œå¤§å¹…ç®€åŒ–å¼‚æ­¥ï¼ŒIOï¼Œæ¸²æŸ“ç­‰ä½œç”¨/å‰¯ä½œç”¨ç›¸å…³ä»£ç ã€‚å’Œå¾ˆå¤šäººæƒ³è±¡çš„ä¸ä¸€æ ·ï¼Œå‡½æ•°å¼å¾ˆæ“…é•¿å¤„ç†ä½œç”¨ï¼Œåªæ˜¯å¤šä¸€å±‚æŠ½è±¡ï¼Œå¦‚æœåº”ç”¨ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œè¿™ç‚¹æˆæœ¬å¾ˆå¿«å°±èƒ½æ‰¾å›æ¥ï¼ˆRedux Sagaæ˜¯ä¸ªä¾‹å­ï¼Œç‰¹åˆ«æ˜¯ä½ å†™æµ‹è¯•çš„æƒ…å†µä¸‹ï¼‰ã€‚æ¸²æŸ“ç°åœ¨å¤§å®¶éƒ½å¯ä»¥ç†è§£å¹‚ç­‰æ¸²æŸ“åœ°å¥½å¤„äº†ï¼Œå…¶å®å‡½æ•°å¼ç¼–ç¨‹å„ç§ä½œç”¨å’ŒçŠ¶æ€ä¹Ÿæ˜¯å¹‚ç­‰çš„ï¼Œå¯¹äºå¤æ‚åº”ç”¨éå¸¸æœ‰å¸®åŠ©ã€‚

#### å¤ç”¨

å¼•ç”¨é€æ˜ï¼Œæ— å‰¯ä½œç”¨ï¼Œä»£æ•°è®¾è®¡è®©å‡½æ•°å¼ä»£ç å¯ä»¥æ­£ç¡®ä¼˜é›…åœ°å¤ç”¨ã€‚å‰ç«¯ä¸åƒåç«¯ä¸šåŠ¡å›ºå®šï¼Œåšå¥½ä¸šåŠ¡åˆ†æå’ŒDDDå°±å¯ä»¥æ­ä¸ªé™æ€ç»“æ„ï¼Œé«˜æ•æ— å¿§äº†ã€‚å‰ç«¯çš„å¥½ä»£ç ä¸€å®šæ˜¯æ´»çš„ï¼Œæ¯å¤„éƒ½å¯èƒ½ä¹±æ”¹ã€‚å¯ç»„åˆæ€§å…¶å®å¾ˆé‡è¦ã€‚é€šè¿‡é«˜é˜¶å‡½æ•°æ¥ç»„åˆæ•ˆæœå’Œæ•ˆç‡éƒ½è¦é«˜äºç»§æ‰¿ï¼Œè¯•ç€å¤šç”¨ramdaï¼Œä½ å°±å¯ä»¥å‘ç°ç»å¤§éƒ¨åˆ†ä¸œè¥¿éƒ½èƒ½ä¸€è¡Œå†™å®Œï¼Œæœ€åç»™ä¸ªå®å‚å°±å˜æˆä¸€ä¸ªUIï¼Œæ¥éœ€æ±‚æ”¹ä¸¤ç¬”å°±å˜æˆå¦å¤–ä¸€ä¸ªã€‚

---

### åˆç†ä½¿ç”¨å‡½æ•°å¼ï¼ˆ

#### Redux çš„ Store ç®¡ç†é€‰æ‹©

- æŸä¸ªçŠ¶æ€åªè¢« 1 ä¸ªç»„ä»¶ä¾èµ–å½±å“

é‚£è¿™ä¸ªçŠ¶æ€æ”¾åœ¨ç»„ä»¶é‡Œçš„ `state` æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œæ²¡æœ‰å…¶ä»–ç»„ä»¶å¯ä»¥è®¿é—®åˆ°å®ƒ

- æŸä¸ªçŠ¶æ€è¢«å¤šä¸ªç»„ä»¶ä¾èµ–å½±å“

ğŸŒ°ï¼šButton => HTTP => Loading Model (Loading State)

é‚£è¿™ä¸ª `Loading State` çš„çŠ¶æ€æ˜¯æ”¾åœ¨ `<Button />` ç»„ä»¶é‡Œè¿˜æ˜¯æ”¾åœ¨ `<Loading />` ç»„ä»¶é‡Œå‘¢ï¼Ÿ

å…¶å®éƒ½ä¸åˆé€‚ï¼Œå¿…ç„¶ä¼šå¯¼è‡´å¦ä¸€ä¸ªç»„ä»¶çš„ä¾èµ–ã€‚è§£å†³æ–¹æ³•æ˜¯æŠŠè¿™ç§çŠ¶æ€**æŠ½ç¦»å‡ºæ¥ä½œä¸ºå…¬å…±éƒ¨åˆ†**

è¿™æ‰æ˜¯ Redux è¿™ç±»çŠ¶æ€ç®¡ç†è§£å†³çš„é—®é¢˜ï¼šç®¡ç†å¤šä¸ªç»„ä»¶æ‰€ä¾èµ–æˆ–è€…å½±å“çš„çŠ¶æ€